
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" content="multipart/form-data">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <title>FSD08BANK</title>
  <link rel="stylesheet" href="index_style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

  <script>
    console.log("New File updated====================================================");
    console.log("New File updated====================================================");
    console.log("New File updated====================================================");
    console.log("New File updated====================================================");
    $(document).ready(function () {
      $("#role").change(function () {
        console.log("New File updated====================================================");
        console.log("New File updated====================================================");
        const selectedOption = $(this).val();
        const valueElement = $("#currentBalanceDiv, #kindDiv");

        // Hide or show the value element based on the selected option
        if (selectedOption === "admin") {
          valueElement.hide(); // Hide the value element
        } else {
          valueElement.show(); // Show the value element
        }
      });


      //validation to each field for registration
      $('#btnRegister').click(function () {

        var emptyInput = "";

        if (!$('#email').val()) {
          emptyInput += "Email ";
        }

        if (!$('#password').val()) {
          emptyInput += "Password ";
        }

        // if (!$('#confimrPassword').val()) {
        //   emptyInput += "Password Confirmation";
        // }

        if (!$('#userName').val()) {
          emptyInput += "User Name ";
        }

        if (!$('#address').val()) {
          emptyInput += "Address ";
        }

        if (!$('#role').val()) {
          emptyInput += "Role ";
        }

        if (emptyInput !== "") {
          $('#modalData').html("Please fill the following field: <b>" + emptyInput + "</b> to Register!!! &#128721;");
          $('#exampleModal').modal('show');
          return;
        }

        //Create User object
        var nowDate = new Date();
        nowDate = nowDate.toLocaleDateString("en-CA");
        var user = {
          email: $('#email').val(),
          passwordhash: $('#password').val(),
          username: $('#userName').val(),
          address: $('#address').val(),
          role: $('#role').val(),
          subscribed: 0,
          isActive: 1,
          songsSinceAd: 0
        }
        //Register User
        $.ajax({
          type: 'POST',
          url: 'http://localhost:8080/api/user/register',
          data: JSON.stringify(user),
          contentType: 'application/json',
          success: function (rdata) {
            debugger;
            alert('success!')
          },
          error: function () {
            // Handle any errors that occur during the Ajax request
            debugger;
            alert("User already exists!");
          }
        });

        //Register Ends
      });

      $('#btnLogin').click(function () {
        //validate inputs
        var emptyLoginInput = "";
        if (!$('#loginUsername').val()) {
          emptyLoginInput += "Id ";
        }

        if (!$('#loginPassword').val()) {
          emptyLoginInput += "Password ";
        }

        if (emptyLoginInput !== "") {
          $('#exampleModalLabel').text("Login");
          $('#modalData').html("Please fill: <b>" + emptyLoginInput + "</b> for login!!! &#128721;");
          $('#exampleModal').modal('show');
          return;
        }
        //Authenticate User
        var user = {
          email: $('#loginUsername').val(),
          passwordhash: $('#loginPassword').val(),
        };
        $.ajax({
          type: 'POST',
          url: 'http://20.151.236.18:8080/api/user/login',
          data: JSON.stringify(user),
          //data: user,
          contentType: 'application/json',
          success: function (udata) {
            // if (udata.isRegistered.data[0] == 0) {
            //   $('#exampleModalLabel').text("Login");
            //   $('#modalData').html("Account is pending for verification!!  <b>Keep checking</b>!! &#128342;");
            //   $('#exampleModal').modal('show');
            // }
            if (user.password == udata.password) {
              sessionStorage.setItem("user_id", udata.id + '');
              sessionStorage.setItem("user_password", udata.password + '');
              sessionStorage.setItem("user_role", udata.role + '');

              if (udata.role == "user") {
                //Route to user page
                $(location).attr('href', 'user.html');
              } else if (udata.role == "admin") {
                //Route to admin page
                $(location).attr('href', 'admin.html');
              } else if (udata.role == "creator") {
                //Route to creator page
                $(location).attr('href', 'creator.html');
              } else if (udata.role == "Advertiser") {
                //Route to advertiser page
                $(location).attr('href', 'advertiser.html');
              }
            } else {
              $('#exampleModalLabel').text("Login");
              $('#modalData').text("Account # or password does not match!!");
              $('#exampleModal').modal('show');
            }

          },
          error: function () {
            alert("Error validating user from database for Login!!");
          }
        });

        //Alert Ends
      });

    });


  </script>
  <title>Register-Login</title>
</head>

<body class="container-fluid"  style="background-color:rgb(0, 30, 80);">
  <br>
  <center><img src="images/Popify.png" alt="popifyLogo" height="60px"></center>
  <div class="navbar">
    <div class="container d-flex align-items-center justify-content-center">
    <center><h3 style="color: white;">Welcome!</h3></center>
    </div>
  </div>

  <div class="row" id="login_row">
    <!-- Login -->

    <div class="col-sm-5 login">
      <center><h2 style="color: white;">Login here</h2></center>
      <br>
      <form>
        <p>TestMPv2-</p>
        <div class="input-group">
          <span class="input-group-text" id="basic-addon1">&#9993;</span>
          <input type="text" id="loginUsername" class="form-control" placeholder="Enter Your Email"
            aria-describedby="basic-addon1">
        </div>
        <div class="input-group" style="margin-top: 20px;">
          <span class="input-group-text" id="basic-addon11">&#128273;</span>
          <input type="password" id="loginPassword" class="form-control" placeholder="Enter Your Password"
            aria-describedby="basic-addon11">
        </div>
        <br>
        <center><button type="button" id="btnLogin" class="btn btn-primary" aria-label="Left Align">Login</button></center>
      </form><br><br>
    </div>

    <!-- Divider -->
    <div class="col-sm-1">
      <div class="vl"></div>
    </div>

    <!-- Register -->
    <div class="col-sm-5 login">
      <center><h2 style="color: white;">Register here</h2></center>
      <br>
      <form>
        <div class="input-group">
          <span class="input-group-text" id="basic-addon2">&#9993;</span>
          <input type="text" id="email" class="form-control" placeholder="Enter Your Email"
            aria-describedby="basic-addon2">
        </div>
        <div class="input-group" style="margin-top: 20px;">
          <span class="input-group-text" id="basic-addon3">&#128273;</span>
          <input type="password" id="password" class="form-control" placeholder="Enter Your Password"
            aria-describedby="basic-addon3">
        </div>
        <!-- <div class="input-group" style="margin-top: 20px;">
          <span class="input-group-text" id="basic-addon3">&#10004;&#65039;</span>
          <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm Your Password"
            aria-describedby="basic-addon3">
        </div> -->
        <div class="input-group" style="margin-top: 20px;">
          <span class="input-group-text" id="basic-addon2">&#128394;</span>
          <input type="text" id="userName" class="form-control" placeholder="Enter Your Username"
            aria-describedby="basic-addon2">
        </div>
        <div class="input-group" style="margin-top: 20px;">
          <span class="input-group-text" id="basic-addon4">&#127969;</span>
          <input type="text" id="address" class="form-control" placeholder="Enter Your Address"
            aria-describedby="basic-addon4">
        </div>
        <div class="input-group" style="margin-top: 20px;">
          <span class="input-group-text" id="basic-addon4">&#128100;</span>
          <select id="role" class="form-control">
            <option value="" selected>Register as: </option>
            <option value="user">Regular User</option>
            <option value="creator">Creator</option>
            <option value="advertiser">Advertiser</option>
          </select>
        </div>

        <br>
        <center><button type="button" id="btnRegister" class="btn btn-primary" aria-label="Left Align">Register</button></center>
      </form>
    </div>

  </div>


  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <span id="modalData"></span>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


</body>

</html>